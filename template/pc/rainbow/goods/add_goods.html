
<!doctype html>

<html>

<head>

<meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}"/>

<meta name="description" content="{$tpshop_config['shop_info_store_desc']}"/>
<title>上传商品 - www.ohbbs.cn 欧皇源码论坛 </title>

<link href="__ROOT__/public/static/css/base.css" rel="stylesheet" type="text/css">

<link href="__ROOT__/public/static/css/seller_center.css" rel="stylesheet" type="text/css">

<link href="__ROOT__/public/static/font/font-awesome/css/font-awesome.min.css" rel="stylesheet" />

<link rel="shortcut icon" type="image/x-icon" href="__ROOT__/public/images/favicon.ico" media="screen"/>
<link rel="shortcut  icon" type="image/x-icon" href="__PUBLIC__/static/images/favicon.ico" media="screen"/>
<link rel="stylesheet" type="text/css" href="__STATIC__/css/tpshop.css"/>
<!--[if IE 7]>

  <link rel="stylesheet" href="__ROOT__/public/static/font/font-awesome/css/font-awesome-ie7.min.css">

<![endif]-->

<script type="text/javascript" src="__ROOT__/public/static/js/jquery.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/seller.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/waypoints.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/jquery-ui/jquery-ui.min.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/jquery.validation.min.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/layer/layer.js"></script>

<script type="text/javascript" src="__ROOT__/public/js/dialog/dialog.js" id="dialog_js"></script>

<script type="text/javascript" src="__ROOT__/public/js/global.js"></script>

<script type="text/javascript" src="__ROOT__/public/js/myAjax.js"></script>

<script type="text/javascript" src="__ROOT__/public/js/myFormValidate.js"></script>

<script type="text/javascript" src="__ROOT__/public/static/js/layer/laydate/laydate.js"></script>

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

<!--[if lt IE 9]>

      <script src="__ROOT__/public/static/js/html5shiv.js"></script>

      <script src="__ROOT__/public/static/js/respond.min.js"></script>

<![endif]-->

</head>

<body>
<include file="public/header" w="w1430"/>
<div id="append_parent"></div>

<div id="ajaxwaitid"></div>

<!--以下是在线编辑器 代码 -->

<style>

    .ncsc-goods-default-pic .goodspic-uplaod .upload-thumb{width: 180px;height:180px; display: inline-block;}

    .ncsc-goods-default-pic .goodspic-uplaod .upload-thumb img{ height: 160px; width: 160px;}

    .ncsc-goods-default-pic .goodspic-uplaod .upload-thumb{line-height: 20px;margin-right: 6px;}

    .ncsc-goods-default-pic .goodspic-uplaod .upload-thumb:nth-child(5n){margin-right: 0;}

    .ncsc-goods-default-pic{display: inherit;}

    /*.ncsc-form-goods dl dd{width: 98%;}*/

    .text-warning {color: #8a6d3b;}a{ color:#666666}

    /*.ncsc-form-goods{padding: 10px;}*/

    .table-bordered {border: 1px solid #f4f4f4;}

    .table { width: 100%;max-width: 100%;margin-bottom: 20px;}

    ul.group-list {width: 96%;min-width: 1000px; margin: auto 5px;list-style: disc outside none;}

    ul.group-list li { white-space: nowrap;float: left; width: 150px; height: 25px;padding: 3px 5px;list-style-type: none;list-style-position: outside;border: 0px;margin: 0px;}

    .row .table-bordered td .btn,.row .table-bordered td img{vertical-align: middle;}

    .row .table-bordered td{padding: 8px;line-height: 1.42857143;}

    .table-bordered{width: 100%}

    .table-bordered tr td{border: 1px solid #f4f4f4;}

    .btn-success {color: #fff;background-color: #48CFAE;border-color: #398439 solid 1px;}

    .btn {display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;

        font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap; vertical-align: middle;

        -ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;

        -ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent; border-radius: 4px;

    }

    .col-xs-8 {width: 66.66666667%;}

    .col-xs-4 {width: 33.33333333%;}

    .col-xs-1, .col-xs-10, .col-xs-11, .col-xs-12, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9 {float: left;}

    .row .tab-pane h4{padding: 10px 0;}

    .row .tab-pane h4 input{vertical-align: middle;}

    .table-striped>tbody>tr:nth-of-type(odd) {background-color: #f9f9f9;}

    .ncap-form-default .title{border-bottom: 0}

    .ncap-form-default dl.row, .ncap-form-all dd.opt/*border-color: #F0F0F0;*/border: none;

    .ncap-form-default dl.row:hover, .ncap-form-all dd.opt:hover{border: none;box-shadow: inherit;}

    a:hover {color: #3BAEDA;text-decoration: none;}

    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th {

        padding: 8px;line-height: 1.42857143;vertical-align: top; border-top: 1px solid #ddd;}

    ul.group-list{min-width: 100%;}

    input{vertical-align:middle;}

    .ncsc-form-goods h4{margin: 10px 0 10px 10px;}

    .clabackkj{background-color: #F5F5F5;border-bottom: solid 1px #E7E7E7;overflow: hidden;}

    .clabackkj h3{border-bottom: 0;display: inline-block;}

    .clabackkj .ncbtn{float: right;margin-right: 15px;height: 12px;line-height: 12px;}

    #tab_goods_images dl dd{width: 99%;}

    .alert-block{margin-top: 0;}

    select{

		min-width:120px;

    }
 .shop-car .tab-cart-tip-warp-box {
    margin-top: 40px;
}
.shop-car .tab-cart-tip-warp-box .tab-cart-tip-warp .tab-cart-tip {
    margin: px auto;
}
.mmm .share-side1 {
    margin-top: -120px;
    }
.massage .share-side1 {
    margin-top: 20px;
}
.hostry .share-side1 {
    margin-top: -80px;
}
.sign .share-side1 {
    margin-top: -40px;
}
#q{
	height:25px;
	margin-top:0px;
	width:394px;
	font-size: 14px;
}
.header {
    background: #fff;
    padding: 22px 0 0 0;
    border-bottom: #aaa;
}
.ecsc-search {
    font-size: 14px;
}
.tphsop2_0 .header .ecsc-search .keyword {
    margin-top: -4px;
}
</style>

<script type="text/javascript" charset="utf-8" src="__ROOT__/public/plugins/Ueditor/ueditor.config.js"></script>

<script type="text/javascript" charset="utf-8" src="__ROOT__/public/plugins/Ueditor/ueditor.all.min.js"> </script>

<script type="text/javascript" charset="utf-8" src="__ROOT__/public/plugins/Ueditor/lang/zh-cn/zh-cn.js"></script>

<script type="text/javascript">

var url="/index.php/Admin/Ueditor/index/savePath/goods";

var ue = UE.getEditor('goods_content',{

    serverUrl :url,

    zIndex: 999,

    initialFrameWidth: "100%", //初化宽度

    initialFrameHeight: 300, //初化高度            

    focus: false, //初始化时，是否让编辑器获得焦点true或false

    maximumWords: 99999, removeFormatAttributes: 'class,style,lang,width,height,align,hspace,valign',//允许的最大字符数 'fullscreen',

    pasteplain:false, //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴

    autoHeightEnabled: true

});

</script>

<!--以上是在线编辑器 代码  end-->

<div class="ncsc-layout wrapper">

     <div id="layoutLeft" class="ncsc-layout-left">

 </div>

    <div id="layoutRight" class="ncsc-layout-right">

        <div class="main-content" id="mainContent">

            <div class="tabmenu">

                <ul class="tab pngFix">

                    <li class="active"><a onclick="select_nav(this);" data-id="tab_tongyong">通用信息</a></li>

                    <li class="normal"><a onclick="select_nav(this);" data-id="tab_goods_images">商品相册</a></li>

                </ul>

            </div>

            <div class="item-publish">

                <form method="post" id="addEditGoodsForm" >

                    <input type="hidden" name="goods_id" value="{$goodsInfo.goods_id}">

                    <input type="hidden" name="user_id" value="{$user_id}">

                    <!-- <input type="hidden" name="cat_id1" value="850">

                    <input type="hidden" name="cat_id2" value="{$cat_id2}">

                    <input type="hidden" name="cat_id3" value="{$cat_id3}">
 -->
                    <div class="ncsc-form-goods active" id="tab_tongyong">

                        <h3 id="demo1">商品基本信息</h3>	`

                        <dl>

                            <dt>商品分类：</dt>

                            <dd id="gcategory">

                                <select name="cat_id1" id="cat_id1">
                                	<option value="850">易物区</option>
                                </select>
                                <select name="一级分类" id="yiji" onchange="fenlei()">
                                    <volist name="yiji" id="vo">
                                       <option value="{$vo['id']}">{$vo["name"]}</option>
                                    </volist>
                                </select>
                                <select name="二级分类" id="erji">
                                    <volist name="erji" id="vos">
                                      <option value="{$vos['id']}">{$vos["name"]}</option>
                                    </volist>
                                <select>

	                                								
                            </dd>

                        </dl>

                        <dl>

                            <dt><i class="required">*</i>商品名称：</dt>

                            <dd>

                                <input type="text" value="" name="goods_name"  class="text w400">

                                <span id="err_goods_name"></span>

                                <p class="hint">商品标题名称长度至少3个字符，最长50个汉字</p>

                            </dd>

                        </dl>

                        <dl>

                            <dt>商品简介：</dt>

                            <dd>

                                <textarea name="goods_remark" class="textarea h60 w400">{$goodsInfo['goods_remark']}</textarea>

                                <span id="err_goods_remark"></span>

                                <p class="hint">商品简介最长不能超过140个汉字</p>

                            </dd>

                        </dl>

                        <dl style="display: none">

                            <dt>商品货号：</dt>

                            <dd>

                                <p>

                                    <input type="text" value="" name="goods_sn" class="text" maxlength="20">

                                </p>

                                <span id="err_goods_sn"></span>

                                <p class="hint">商品货号是指管理商品的编号<br>最多可输入20个字符，支持输入中文、字母、数字、_、/、-和小数点</p>

                            </dd>

                        </dl>

                        <dl>

                            <dt><i class="required">*</i>商品图片：</dt>

                            <dd>

                                <div class="ncsc-goods-default-pic">

                                    <div class="goodspic-uplaod">

                                        <div class="upload-thumb">

                                            <img id="original_img2" src="__ROOT__{$goodsInfo['original_img']?$goodsInfo['original_img']:'/public/static/images/default_goods_image_240.gif'}">

                                        </div>

                                        <input name="original_img" id="original_img" value="" type="hidden">

                                        <p class="hint">上传商品默认主图，如多规格值时将默认使用该图或分规格上传各规格主图；支持jpg、gif、png格式上传或从图片空间中选择，建议使用<font color="red">尺寸800x800像素以上、大小不超过1M的正方形图片</font>，上传后的图片将会自动保存在图片空间的默认分类中。</p>

                                        <div class="handle">

                                            <div class="ncsc-upload-btn">

                                                <a onclick="GetUploadify(1,'','goods','call_back');">

                                                    <p><i class="icon-upload-alt"></i>图片上传</p>

                                                </a>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                                <div id="demo"></div>

                            </dd>

                        </dl>
						
						<dl class="goods_shipping">

                            <dt>商品损耗：</dt>

                            <dd>

                                <select name="fewnew" id="fewnew">
                                	<option value="6">6成新</option>
                                	<option value="7">7成新</option>
                                	<option value="8">8成新</option>
                                	<option value="9">9成新</option>
                                </select>
								<p class="hint">请根据该实际情况认真选择。</p>
                            </dd>

                        </dl>
                        
                        <dl class="goods_shipping">

                            <dt>商品重量：</dt>

                            <dd>

                                <p>

                                    <input type="text"  value="{$goodsInfo['weight']}" name="weight" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onpaste="this.value=this.value.replace(/[^\d.]/g,'')" class="text">

                                </p>

                                <p class="hint">克 (以克为单位)</p>

                            </dd>

                        </dl>

                        <dl>

                            <dt nc_type="no_spec"><i class="required">*</i>商品数量</dt>

                            <dd nc_type="no_spec">

                                
                                    <input name="store_count" value="{$goodsInfo['store_count']}" onkeyup="this.value=this.value.replace(/\D/g,'')" onpaste="this.value=this.value.replace(/\D/g,'')" class="text w60" type="text">
                                    <span></span>

                                <p class="hint">商品数量必须为0~999999999之间的整数<br></p>

                            </dd>

                        </dl>

                        <dl>
                        
                            <dt>兑换积分：</dt>

                            <dd>

                                <p>

                                    <input type="text" value="{$goodsInfo['exchange_integral']}" id="exchange_integral" name="exchange_integral" onkeyup="this.value=this.value.replace(/\D/g,'')" onpaste="this.value=this.value.replace(/\D/g,'')" class="text">

                                </p>

                                <p class="hint">兑换该商品可使用多少积分，积分比例1元:1分</p>

                            </dd>

                        </dl>
						
<!-- 						<dl>
                            <dt>成本价：</dt>

                            <dd>

                                <input value="{$goodsInfo.cost_price}" name="cost_price" class="text w60" type="text" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onpaste="this.value=this.value.replace(/[^\d.]/g,'')"><em class="add-on"><i class="icon-renminbi"></i></em> <span></span>



                                <p class="hint">价格必须是0.00~9999999之间的数字，此价格为商户对所销售的商品实际成本价格进行备注记录，非必填选项，不会在前台销售页面中显示。</p>

                            </dd>

                        </dl> -->
                        
                        <dl>
                            <dt>市场价：</dt>

                            <dd>

                                <input value="{$goodsInfo.market_price}" name="market_price" class="text w60" type="text" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onpaste="this.value=this.value.replace(/[^\d.]/g,'')"><em class="add-on"><i class="icon-renminbi"></i></em> <span></span>



                                <p class="hint">价格必须是0.00~9999999之间的数字，此价格为商户对所销售的商品实际成本价格进行备注记录，非必填选项，不会在前台销售页面中显示。</p>

                            </dd>

                        </dl>
                        <!-- <dl>
                            <dt>联系人：</dt>

                            <dd>

                                <input value="" id="chact" name="chact" class="text w60" type="text" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onpaste="this.value=this.value.replace(/[^\d.]/g,'')"><em class="add-on"><i class="icon-renminbi"></i></em> <span></span>
                                <p class="hint">请填写真实手机号码。</p>

                            </dd>

                        </dl> -->

                        <dl>

                            <dt>商品关键词：</dt>

                            <dd>

                                <p>

                                    <input type="text" value="{$goodsInfo['keywords']}" name="keywords" class="text">

                                </p>

                                <p class="hint">多个关键词，用空格隔开</p>

                            </dd>

                        </dl>
					    
                        <h3 id="demo2">商品详情描述</h3>

                        <dl>

                            <dt>商品详情描述：</dt>

                            <dd>

                                <p>

                                    <textarea id="goods_content" name="goods_content" class="txt">{$goodsInfo['goods_content']}</textarea>

                                </p>

                                <p class="hint">商品详情描述</p>

                            </dd>

                        </dl>

                    </div>



                    <div class="ncsc-form-goods" id="tab_goods_images" style="display: none;">

                        <dl>

                            <dd>

                                <div class="ncsc-form-goods-pic">

									<div class="container">

							            <div class="ncsc-goodspic-list" style="opacity: 1;">

								        <div class="clabackkj">

								          <h3>管理缩略图</h3>

								          <a ata-original-title="添加商品" onclick="add_image();" class="ncbtn ncbtn-grapefruit mt5"><i class="fa fa-plus"></i>添加缩略图</a>

								         </div>

								        	<ul nctype="ul0" class="goods-pic-list">
				
								        		<foreach name="imgs" item='v' key="k">
	                                                <li class="ncsc-goodspic-upload">

	                                                    <div class="upload-thumb"><a onclick="" href="{$v['image_url']}" target="_blank"><img nctype="file_{$k}" src="__ROOT__{$v['image_url']}"/>
	                                                      <input type="hidden" value="{$v['image_url']}" name="goods_images[]" data-id="file_{$K}">
														  </a>
	                                                    </div>

	                                                    <div class="show-default">

	                                                        <p><i class="icon-ok-circle"></i>

	                                                        </p><a title="移除" onclick="ClearPicArr2(this,'')" class="del" nctype="del" href="javascript:void(0)">X</a>

	                                                    </div>

	                                                    <div class="show-sort">排序 ：<input type="text" maxlength="1" size="1" class="text" name="img_sorts[]">

	                                                    </div>

	                                                    <div class="ncsc-upload-btn"><a href="javascript:void(0);" onclick="img_upload(10, 'file_0', 'goods', 'call_back2');"><span></span><p><i class="icon-upload-alt"></i>上传</p></a>

	                                                    </div>

	                                                </li>

                                            	</foreach>

                                            	<if condition="count($imgs) lt 5">

	                                            	<for start="count($goodsImages)" end="5">

		                                                <li class="ncsc-goodspic-upload">

		                                                    <div class="upload-thumb"><a onclick="" href="#" target="_blank"><img nctype="file_{$i}" src="__ROOT__/public/static/images/default_goods_image_240.gif"></a>

		                                                        <input type="hidden" value="" name="goods_images[]" data-id="file_{$i}">

		                                                    </div>

		                                                    <div class="show-default">

		                                                        <p><i class="icon-ok-circle"></i>

		                                                        </p><a title="移除" onclick="ClearPicArr2(this,'')" class="del" nctype="del" href="javascript:void(0)">X</a>

		                                                    </div>

		                                                    <div class="show-sort">排序 ：<input type="text" maxlength="1" size="1" class="text" name="img_sorts[]">

		                                                    </div>

		                                                    <div class="ncsc-upload-btn"><a href="javascript:void(0);" onclick="img_upload(10, 'file_{$i}', 'goods', 'call_back2');"><span></span><p><i class="icon-upload-alt"></i>上传</p></a>

		                                                    </div>

		                                                </li>
																				
	                                            	</for>
                                            	</if>
                                                    
									      	</ul>

									        <input type="hidden" value="" name="goods_images[]" >

									    </div>

								      </div>

								      <div class="sidebar"><div class="alert alert-info alert-block" id="uploadHelp">

									    <div class="faq-img"></div>

									    <h4>上传要求：</h4><ul>

									    <li>1. 请使用jpg\jpeg\png等格式、单张大小不超过1M的正方形图片。</li>

									    <li>3. 最多可上传10张图片，默认前面5张上传框不可删除, 新增加的上传框可删除, 但对上传的图片无影响, 已实际上传图片数量为准</li>

									    <li>4. 更改排序数字修改商品图片的排列显示顺序, 数字越小的越靠前显示</li>

									    <li>5. 图片质量要清晰，不能虚化，要保证亮度充足。</li>

									    <li>6. 操作完成后请点击"保存"按钮 , 否则上传的图片不会被保存</li>

									    </ul><h4>建议:</h4><ul><li>1. 主图为白色背景正面图。</li><li>2. 排序依次为正面图-&gt;背面图-&gt;侧面图-&gt;细节图。</li></ul></div>

									   </div>

								</div>

                            </dd>

                        </dl>

                    </div>

                    <div class="bottom tc hr32">

                        <label class="submit-border">

                            <input nctype="formSubmit" class="submit" id="submit" value="保存" type="submit">

                        </label>

                    </div>

                </form>

            </div>

        </div>

    </div>

</div>

<include file="public/footer"/>

<include file="public/sidebar_cart" />

<script type="text/javascript" src="__ROOT__/public/static/js/jquery.cookie.js"></script>



<script type="text/javascript" src="__ROOT__/public/static/js/perfect-scrollbar.min.js"></script> 

<script type="text/javascript" src="__ROOT__/public/static/js/qtip/jquery.qtip.min.js"></script>


<script type="text/javascript">

var current_control = 'Goods/addEditGoods';

$(document).ready(function(){

    //添加删除快捷操作

    $('[nctype="btn_add_quicklink"]').on('click', function() {

        var $quicklink_item = $(this).parent();

        var item = $(this).attr('data-quicklink-act');

        if($quicklink_item.hasClass('selected')) {

            $.post("/index.php/Seller/Index/quicklink_del", { item: item }, function(data) {

                $quicklink_item.removeClass('selected');

                var idstr = 'quicklink_'+ item;

                $('#'+idstr).remove();

            }, "json");

        } else {

            var scount = $('#quicklink_list').find('dd.selected').length;

            if(scount >= 8) {

                layer.msg('快捷操作最多添加8个', {icon: 2,time: 2000});

            } else {

                $.post("/index.php/Seller/Index/quicklink_add", { item: item }, function(data) {

                    $quicklink_item.addClass('selected');

                    if(current_control=='Index/index'){

                        var $link = $quicklink_item.find('a');

                        var menu_name = $link.text();

                        var menu_link = $link.attr('href');

                        var menu_item = '<li id="quicklink_' + item + '"><a href="' + menu_link + '">' + menu_name + '</a></li>';

                        $(menu_item).appendTo('#seller_center_left_menu').hide().fadeIn();

                    }

                }, "json");

            }

        }

    });

    //浮动导航  waypoints.js

    $("#sidebar,#mainContent").waypoint(function(event, direction) {

        $(this).parent().toggleClass('sticky', direction === "down");

        event.stopPropagation();

        });

    });

    // 搜索商品不能为空

    $('input[nctype="search_submit"]').click(function(){

        if ($('input[nctype="search_text"]').val() == '') {

            return false;

        }

    });



	function fade() {

		$("img[rel='lazy']").each(function () {

			var $scroTop = $(this).offset();

			if ($scroTop.top <= $(window).scrollTop() + $(window).height()) {

				$(this).hide();

				$(this).attr("src", $(this).attr("data-url"));

				$(this).removeAttr("rel");

				$(this).removeAttr("name");

				$(this).fadeIn(500);

			}

		});

	}

	if($("img[rel='lazy']").length > 0) {

		$(window).scroll(function () {

			fade();

		});

	};

	fade();

	

    function delfunc(obj){

    	layer.confirm('确认删除？', {

    		  btn: ['确定','取消'] //按钮

    		}, function(){

    		    // 确定

   				$.ajax({

   					type : 'post',

   					url : $(obj).attr('data-url'),

   					data : {act:'del',del_id:$(obj).attr('data-id')},

   					dataType : 'json',

   					success : function(data){

                        layer.closeAll();

   						if(data==1){

   							layer.msg('操作成功', {icon: 1});

   							$(obj).parent().parent().parent().remove();

   						}else{

   							layer.msg(data, {icon: 2,time: 2000});

   						}

   					}

   				})

    		}, function(index){

    			layer.close(index);

    			return false;// 取消

    		}

    	);

    }

</script>

<script>

    /*

     * 上传之后删除组图input

     * @access   public

     * @val      string  删除的图片input

     */

    function ClearPicArr2(obj,path){

        var action = $(obj).attr('ncaction');

        if(action != undefined && action =='del'){

            $(obj).parent().parent().remove();

        }

        //删除图片文件

        if(path == '' || path == undefined){

            return;

        }

        // 删除数据库记录

         $.ajax({

            type:'GET',

            url:"/index.php/Seller/Goods/del_goods_images",

            data:{filename:path},

            success:function(){

                 $(obj).parent().siblings('.upload-thumb').find('img').attr("src", '__ROOT__/public/static/images/default_goods_image_240.gif'); // 删除完服务器的, 再删除 html上的图片

                //删除input goods_image

                $(obj).parent().siblings('.upload-thumb').find('input[type=hidden]').val("");

                $(obj).parent().siblings('.show-sort').find('input[type=text]').val("0");

                

                //如果删除的是商品主图, 则把商品主图隐藏域删掉

                if($("#original_img").val() == path){

                	$("#original_img").val("");

                    $("#original_img2").attr("src" , '__ROOT__/public/static/images/default_goods_image_240.gif');

                }

            }

        });

    }



    function select_nav(obj){

        var data_id = $(obj).attr('data-id');

        $('.ncsc-form-goods').hide();

        $('#'+data_id).show();

        $(obj).parent().parent().find('li').removeClass('active');

        $(obj).parent().addClass('active');

    }

    // 上传商品图片成功回调函数

    function call_back(fileurl_tmp){

        $("#original_img").val(fileurl_tmp);

        $("#original_img2").attr('src', fileurl_tmp);

    }



    var cur_img_id = "";

    function img_upload(num,elementid,path,callback){

    	cur_img_id = elementid;

    	GetUploadify(num,elementid,path,callback);

    }



    // 上传商品相册回调函数

    function call_back2(paths){

    	if(paths == undefined || paths[0] == undefined) return ;

    	$("img[nctype="+cur_img_id+"]").attr("src" , paths[0]);

    	$("input[data-id="+cur_img_id+"]").val(paths[0]);



    	//重新绑定删除事件

    	$("input[data-id="+cur_img_id+"]").parent().siblings(".show-default").find("a:eq(0)").removeAttr('onclick').click(function(){  ClearPicArr2(this, paths[0]) }); ;



    }



    /**

     *	添加图片

     */

    function add_image(){

    	var length = $('.goods-pic-list>.ncsc-goodspic-upload').length;

    	if(length >= 10){

    		layer.alert("缩略图数量不能超过10个!", {icon:2});

    		return;

    	}

    	var new_id = "file_"+(length);

    	var  last_div = $(".goods-pic-list:last").children("li:first-child").prop("outerHTML");

    	$(".goods-pic-list:last").children("li:last-child").after(last_div);



    	var last_li = $(".goods-pic-list").children("li:last-child");

    	//第一个: a标签

    	last_li.find("a:eq(0)").attr("href" ,  '__ROOT__/public/static/images/default_goods_image_240.gif');

    	//img标签

    	last_li.find("img:eq(0)").attr("nctype" , new_id).attr("src" ,  '__ROOT__/public/static/images/default_goods_image_240.gif'); //src

    	//隐藏域: goods_images

    	last_li.find("input[type=hidden]:eq(0)").attr("data-id" , new_id);

    	//排序字段:

    	last_li.find("input.text").val(0);



    	//第二个: a标签 移除, 图片上传后, 修改ClearPicArr2参数, 添加ncaction属性, 如果该属性是del, 说明是超过5个的上传框, 可以删除.

    	last_li.find("a:eq(1)").attr("ncaction" , "del").removeAttr('onclick').click(function(){  ClearPicArr2(this,'') });

    	//第三个: a标签, 上传图片按钮

    	last_li.find("a:eq(2)").unbind('click').removeAttr('onclick').click(function(){  img_upload(10,  new_id, 'goods', 'call_back2') });



    }


    /** 以下是编辑时默认选中某个商品分类*/

    $(document).ready(function(){


		$("#addEditGoodsForm").validate({

    		debug: false, //调试模式取消submit的默认提交功能   

    		focusInvalid: false, //当为false时，验证无效时，没有焦点响应  

            onkeyup: false,   

            submitHandler: function(form){   //表单提交句柄,为一回调函数，带一个参数：form

                $('#submit').attr('disabled',true);  

            	//var give_integral = $("input[name='give_integral']").val();

            	// if(give_integral > send_point){

            	// 	layer.alert("最多可赠送积分不能超过"+send_point , {icon:2, time:2000});

            	// 	return;

            	// }

                $.ajax({

                    type: "POST",

                    url: "/index.php/Home/Goods/save",

                    data: $('#addEditGoodsForm').serialize(),

                    dataType: "json",

                    error: function(request) {

                        layer.alert("服务器繁忙, 请联系管理员!",{icon:2});

                        return false;

                    },

                    success: function (data) {

                        if (data.status == 1) {

                            layer.msg(data.msg,{icon: 1,time: 2000});

                            $("input[name=goods_id]").attr('value',data.result.goods_id);

                            window.location.href="/index.php/Home/Index/index";

                        } else {

                            $('#submit').attr('disabled',false);

                            layer.msg(data.msg,{icon: 2,time: 1000});

                            // 验证失败提示错误

                            for (var i in data.result) {

                                $("#err_" + i).text(data.result[i]).show(); // 显示对于的 错误提示

                            }

                        }

                    }

                });

            },

            ignore:":button,:checkbox",	//不验证的元素

            rules:{

            	goods_name:{

            		required:true

            	},

            	market_price:{

            		required:true,

            		number:true,

            		min:0

            	},
            	

            	exchange_integral:{

            		required:true,

            		number:true,

            		min:0

            	},

            	store_count:{

            		required:true,

            		digits:true,

            		min:0

            	}

            },

            messages:{

            	goods_name:{

            		required:"请填写商品名称"

            	},

                market_price:{

            		required:"请填写商品成本价",

            		number:"请输入数字",

            		min:"商品价格不能小于0"

            	},

            	exchange_integral:{

            		required:"请填写兑换积分额",

            		number:"请输入数字",

            		min:"兑换积分不能小于0"

            	},

            	store_count:{

            		required:"请输入商品数量",

            		digits:"必须是正数",

            		min:"商品数量不能小于0"

            	}

            }

    	});

    });

    // function get_store_category(id,next,select_id){

    //     var url = '/index.php?m=Home&c=api&a=get_store_category&parent_id='+ id;

    //     $.ajax({

    //         type : "GET",

    //         url : url,

    //         error: function(request) {

    //             layer.alert("服务器繁忙, 请联系管理员!",{icon:2});

    //             return;

    //         },

    //         success: function(v) {

    //             v = "<option value='0'>请选择商品分类</option>" + v;

    //             $('#'+next).empty().html(v);

    //             (select_id > 0) && $('#'+next).val(select_id);//默认选中

    //         }

    //     });

    // }



    // // 属性输入框的加减事件

    // function addAttr(a)

    // {

    //     var attr = $(a).parent().parent().prop("outerHTML");

    //     attr = attr.replace('addAttr','delAttr').replace('+','-');

    //     $(a).parent().parent().after(attr);

    // }

    // // 属性输入框的加减事件

    // function delAttr(a)

    // {

    //     $(a).parent().parent().remove();

    // }

    function choosebox(o){

        var vt = $(o).is(':checked');

        if(vt){

            $('input[type=checkbox]').prop('checked',vt);

        }else{

            $('input[type=checkbox]').removeAttr('checked');

        }

    }

    $(document).ready(function(){

        $(":checkbox[cka]").click(function(){

            var $cks = $(":checkbox[ck='"+$(this).attr("cka")+"']");

            if($(this).is(':checked')){

                $cks.each(function(){$(this).prop("checked",true);});

            }else{

                $cks.each(function(){$(this).removeAttr('checked');});

            }

        });

    });
    function fenlei(){
      var option="<option value='0'>未选择</option>";
      var url = '/index.php?m=mobile&c=Goods&a=ywsqings';
      var num=document.getElementById("yiji").value;
      $.ajax({
              type : "POST",
              url  : url,
              data : "num="+ num,
              success: function(ew) {
                //$("#erji").html(createOption(ew[k].id,ew[k].name));
                 $("#erji").html(ew);
              }
          });
    }

</script>

</body>

</html>

